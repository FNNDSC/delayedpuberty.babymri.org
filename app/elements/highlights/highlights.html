<link rel="import" href="../page/page.html">
<link rel="import" href="../people/people.html">

<polymer-element name="highlights-element" extends="page-element">
  <template>
    <link rel="stylesheet" type="text/css" href="highlights.css" />

    <div class='pageTitle'>
      <div class="container">
        <div id="jumbo" class=" jumbotron" >
          <template if="{{(research == null) && (cache == null)}}">
            <img class="spinner" src="../../images/spinner.gif">
          </template>
          <span class="small">Some of our center's</span>
          <span class="large {{name}}">highlights</span>
        </div>
      </div>
    </div>

    <div id="navnavContainer">
         <div id="navnav">
        <div class="row">
          <div class='container'>
            <ul class='navbar-nav nav'>
              <template if="{{structure != null}}">
                <template repeat="{{section in structure}}">
                  <li on-tap="{{gotoSection}}" class='nav-element'>
                    <a id='{{name}}-nav-{{section.index}}' class='{{name}}' data-section='{{section.index}}'>{{section.label}}</a>
                  </li>
                </template>
              </template>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Paper Dialog -->
    <paper-dialog heading="More about" transition="paper-dialog-transition-center" tabindex="-1" class="paper-dialog-transition paper-dialog-transition-center" style="z-index: 2000; position: fixed; display: none;">
      <content>

        <div id="what"></div>
        <div id="who"></div>

        <div id="more">
        </div>
        <div id="link"></div>

      </content>

      <paper-button label="Close" affirmative default></paper-button>

    </paper-dialog>

    <div class="container">
      <div class="">
        <div class="col-md-12 col-lg-12">
        <div class="fBox">
        <section id="ttfourteen" class="element">
          <div class='row card'>
          <div class="title">2014</div>

          <div class='row'>
            <template if="{{highlights != null}}">
              <template repeat="{{highlight in highlights.feed.entry}}">
                <template if="{{highlight.gsx$year.$t === '2014'}}">
                  <card-element cardObject="{{highlight}}" cardLoaded="{{highlightLoaded}}" cardSelected="{{highlightSelected}}"></card-element>
</template>
              </template>
            </template>
        </div>
</div>
        </section>

        <section id="ttthirteen" class="element">
          <div class='row card'>
          <div class="title">2013</div>

          <div class='row'>
            <template if="{{highlights != null}}">
              <template repeat="{{highlight in highlights.feed.entry}}">
                <template if="{{highlight.gsx$year.$t === '2013'}}">
<card-element cardObject="{{highlight}}" cardLoaded="{{highlightLoaded}}" cardSelected="{{highlightSelected}}"></card-element>
                </template>
              </template>
            </template>
          </div>
        </div>
        </section>

        <section id="tttwelve" class="element">
          <div class='row card'>
          <div class="title">2012</div>

          <div class='row'>
            <template if="{{highlights != null}}">
              <template repeat="{{highlight in highlights.feed.entry}}">
                <template if="{{highlight.gsx$year.$t === '2012'}}">
<card-element cardObject="{{highlight}}" cardLoaded="{{highlightLoaded}}" cardSelected="{{highlightSelected}}"></card-element>
                </template>
              </template>
            </template>
          </div>
          </div>
        </section>

        <section id="tteleven" class="element">
          <div class='row card'>
          <div class="title">2011</div>

          <div class='row'>
            <template if="{{highlights != null}}">
              <template repeat="{{highlight in highlights.feed.entry}}">
                <template if="{{highlight.gsx$year.$t === '2011'}}">
                  <card-element cardObject="{{highlight}}" cardLoaded="{{highlightLoaded}}" cardSelected="{{highlightSelected}}"></card-element>

                </template>
              </template>
            </template>
          </div>
        </div>

        </section>

      </div>
    </div>

    <template if="{{cache == null && attached == 1 }}">
      <polymer-jsonp auto url="https://spreadsheets.google.com/feeds/list/{{spreadsheet}}/od6/public/values?alt=json-in-script&callback=" response="{{highlights}}"></polymer-jsonp>
    </template>

  </template>

  <script>
    Polymer('highlights-element', {
      name:'highlights',
      spreadsheet: '0Asu7h0aKnydhdHlaTndWaUVmOHRpRTMzX3VmWW9VVFE',
      attached: function(){
        this.super();

        if(this.cache != null){
          this.highlights = this.cache;
        }
        this.attached = 1;
      },
      highlightsChanged: function() {
        if(this.highlights){
          // // format the object
          // <template repeat="{{people in team.feed.entry}}">
          //   <template if="{{people.gsx$group.$t === 'faculty'}}">
          //     <card-element cardObject="{{people}}" cardLoad
          // {{cardObject.gsx$title.$t}}
          // {{cardObject.gsx$art.$t}}
          // {{cardObject.gsx$date.$t}}
          // {{cardObject.gsx$category.$t}}
          // {{cardObject.gsx$l1.$t}}
          // {{cardObject.gsx$l2.$t}}
          // {{cardObject.gsx$l3.$t}}
          for(var i = 0; i < this.highlights.feed.entry.length; i++){
            // generate title if no title
            if(!this.highlights.feed.entry[i].gsx$title){
              this.highlights.feed.entry[i].gsx$title = {$t:''};
              this.highlights.feed.entry[i].gsx$title.$t = this.highlights.feed.entry[i].gsx$group.$t;
            }

            // generate text for the lines
            if(!this.highlights.feed.entry[i].gsx$l1){
              this.highlights.feed.entry[i].gsx$l1 = {$t:''};
              this.highlights.feed.entry[i].gsx$l1.$t = this.highlights.feed.entry[i].gsx$what.$t.substring(0,140);
              if(this.highlights.feed.entry[i].gsx$what.$t.length > 140){
                this.highlights.feed.entry[i].gsx$l1.$t += '...';
              }
            }
            // if(!this.team.feed.entry[i].gsx$l2){
            //   this.team.feed.entry[i].gsx$l2 = {$t:''};
            //   this.team.feed.entry[i].gsx$l2.$t = this.team.feed.entry[i].gsx$academictitle.$t;
            // }
            // if(!this.team.feed.entry[i].gsx$l3){
            //   this.team.feed.entry[i].gsx$l3 = {$t:''};
            //   this.team.feed.entry[i].gsx$l3.$t = this.team.feed.entry[i].gsx$department.$t;
            // }
          }

          this.cache = this.highlights;
        }
      },
      highlightSelectedChanged: function(){
        // update content of dialog
        if(this.highlightSelected != null){
          this.$.what.innerHTML = this.highlightSelected.gsx$what.$t;
          this.$.who.innerHTML = this.highlightSelected.gsx$who.$t;
          this.$.more.innerHTML = this.highlightSelected.gsx$where.$t;
          this.$.more.innerHTML += ', ' + this.highlightSelected.gsx$month.$t + " " + this.highlightSelected.gsx$day.$t + " " + this.highlightSelected.gsx$year.$t;
          if(this.highlightSelected.gsx$location.$t != ''){
            this.$.more.innerHTML += ', ' + this.highlightSelected.gsx$location.$t;
          }

          if(this.highlightSelected.gsx$link.$t != ''){
            this.$.link.innerHTML = "<a target='_blank' href='" + this.highlightSelected.gsx$link.$t + "'>"+this.highlightSelected.gsx$link.$t+"</a>";
          }
          else{
            this.$.link.innerHTML = "";
          }

          var dialog = this.shadowRoot.querySelector('paper-dialog');
          dialog.shadowRoot.querySelector('#main h1').innerHTML = this.highlightSelected.gsx$group.$t;
          dialog.toggle();

          this.highlightSelected = null;
        }

      }
    });
  </script>
</polymer-element>
