<link rel="import" href="../page/page.html">
<link rel="import" href="../event/event.html">

<link rel="import" href="../../lib-elements/paper-button/paper-button.html">
<link rel="import" href="../../lib-elements/paper-dialog/paper-dialog-transition.html">
<link rel="import" href="../../lib-elements/paper-dialog/paper-dialog.html">

<polymer-element name="live-element" extends="page-element">
  <template>

    <link rel="stylesheet" type="text/css" href="live.css" />

    <!-- Title -->
    <div class='pageTitle'>
      <div class="container">
        <div id="jumbo" class=" jumbotron" >
          <template if="{{(research == null) && (cache == null)}}">
            <span class="spinner"><img src="../../images/spinner.gif"></span>
          </template>
          <span class="small">We stream live</span>
          <span class="large {{name}}">events</span>
        </div>
      </div>
    </div>

    <!-- Paper Dialog -->
    <paper-dialog heading="Abstract" transition="paper-dialog-transition-center" tabindex="-1" class="paper-dialog-transition paper-dialog-transition-center" style="z-index: 2000; position: fixed; display: none;">
      <content>

        <div id="abstract"></div>

      </content>

      <paper-button label="Close" affirmative default></paper-button>

    </paper-dialog>

    <!-- Content -->
    <div class="container">
      <div class="row">
        <div class="col-md-1 col-lg-2">
          <div id='{{name}}-affix'>
            <ul id='{{name}}-navigation' class="nav ">
              <template if="{{structure != null}}">
                <template repeat="{{section in structure}}">
                  <li on-tap="{{gotoSection}}">
                    <a id='{{name}}-nav-{{section.index}}' class='{{name}}' data-section='{{section.index}}'>{{section.label}}</a>
                  </li>
                </template>
              </template>
            </ul>
          </div>
        </div>
        <div class="col-md-11 col-lg-10">
          <div class="fBox">
            <section id="live" class='element'>

              <div class='row card'>

                <div id="liveSectionTitle" class="title {{name}}">Upcoming talks</div>

              <template if="{{live != null}}">
                <template repeat="{{event in live.feed.entry}}">
                  <template if="{{event.gsx$section.$t === 'next'}}">
                    <div>
                      <event-element event="{{event}}" eventSelected="{{eventSelected}}"></event-element>
                    </div>
                  </template>
                </template>
              </template>
            </div>
            </section>

            <section id="fnndsctalks" class='element'>

              <div class='row card'>

                <div id="prevTitle" class="title {{name}}">Fnndsc talks</div>

              <template if="{{live != null}}">
                <template repeat="{{event in live.feed.entry}}">
                  <template if="{{event.gsx$section.$t === 'fnndsctalk'}}">
                    <div>
                      <event-element event="{{event}}" eventSelected="{{eventSelected}}"></event-element>
                    </div>
                  </template>
                </template>
              </template>
            </div>
            </section>

            <section id="unix101" class='element'>

              <div class='row card'>

                <div id="prevTitle" class="title {{name}}">Unix 101 series</div>
              <template if="{{live != null}}">
                <template repeat="{{event in live.feed.entry}}">
                  <template if="{{event.gsx$section.$t === 'unix101'}}">
                    <div>
                      <event-element event="{{event}}" eventSelected="{{eventSelected}}"></event-element>
                    </div>
                  </template>
                </template>
              </template>
            </div>
            </section>
          </div>
        </div>
      </div>
    </div>

    <template if="{{cache == null && attached == 1 }}">
      <polymer-jsonp auto url="https://spreadsheets.google.com/feeds/list/{{spreadsheet}}/od6/public/values?alt=json-in-script&callback=" response="{{live}}"></polymer-jsonp>
    </template>

  </template>

  <script>
    Polymer('live-element', {
      name: 'live',
      spreadsheet: '0Asu7h0aKnydhdHdNOUMxWVVvQkJlQUZvYTFQX0t5OXc',
      attached: function(){
        this.super();
        if(this.cache != null){
          this.live = this.cache;
        }
        this.attached = 1;
      },
      liveChanged: function(){
        if(this.live){
          this.cache = this.live;
        }
      },
      eventSelectedChanged: function(){
        // update content of dialog
        if(this.eventSelected != null){
          this.$.abstract.innerHTML = this.eventSelected.gsx$abstract.$t;

          var dialog = this.shadowRoot.querySelector('paper-dialog');
          dialog.shadowRoot.querySelector('#main h1').innerHTML = this.eventSelected.gsx$title.$t;
          dialog.toggle();

          this.eventSelected = null;
        }

      },
    });

  </script>
</polymer-element>
